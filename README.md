# fif-payment-bff-coupons
Backend for frontend to handle coupons requests
## Dependencies installation
```sh
    npm install
```
### Context environment
The context has the general information about the system, general configuration and the order of the middlewares which will be called at the begging.

These file have to be created at

```sh
    /context/definitions/
```

The dafault is **default.js**. The name of the file is handled by the ENV called **NODE_ENV_CONTEXT**

```sh
    NODE_ENV_CONTEXT=default
```

### Environments

Normally exists 4. local, development, qa and production. These are set by the ENV called **NODE_ENV**

```sh
    NODE_ENV=local
```

The specific configurations are in **app/config**.

## To run  local

To run the service locally, the following  command has to be run

```sh
    npm run dev
```

## Swagger

There is an endpoint to see the swagger file

run the service and go to:

[http://localhost:{PORT}/api-docs/swagger](http://localhost:{PORT}/api-docs/swagger)

## Diagrams

The diagrams of the service can be found in **diagrams** folder.

There is a sequence diagram build with **websequencediagrams**. To see it go to

[websequencediagrams](https://www.websequencediagrams.com/)

Copy the content of websequencediagrams.txt and paste on the site.

## Postman collection

The is a postman collection to test the endpoints locally. The collection is in **postman-collection**

## Unit testing

to run the tests

```sh
    npm run test
```

## Coverage

To see the current coverage

```sh
    npm run coverage
```

To get and html report inside your project and see more details about the coverage

```sh
    npm run coverage-html
```

## Linter

To run linter

```sh
    npm run lint
```

## lcov file

The **lcov** can be generated by the command

```sh
    npm run lcov
```

the lcov file will be moved to the root in order to be read  by Sonar(the pipeline has to have a stage to do this)

## mutation testing

To run the mutation testing

```sh
    npm run mutation-test
```

**Note**  All the unit tests have to run without any problems.

This command will take a while. The **thresholds** is configured at **stryker.conf.js** (the coverage has to be over 60%)
